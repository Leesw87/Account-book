<!DOCTYPE html>
<html lang="ko">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>
  <script src="app.js"></script>
  
  <meta charset="UTF-8">
  <title>ê°€ê³„ë¶€</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 30px auto; }
    input, select, button { padding: 8px; margin: 4px 0; width: 100%; }
    ul { padding: 0; }
    li {
      list-style: none;
      padding: 6px 0;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .info { font-size: 14px; }
    .stats { margin-top: 20px; font-weight: bold; }
    button.delete { width: auto; background: #ff6b6b; color: white; border: none; }
  </style>
</head>
<body>

<h2>ğŸ“’ ê°€ê³„ë¶€</h2>

<input type="date" id="date">
<input type="number" id="amount" placeholder="ê¸ˆì•¡">

<select id="type">
  <option value="ê³ ì •ì§€ì¶œ">ê³ ì •ì§€ì¶œ</option>
  <option value="ì¹´ë“œì§€ì¶œ">ì¹´ë“œì§€ì¶œ</option>
  <option value="í˜„ê¸ˆì§€ì¶œ">í˜„ê¸ˆì§€ì¶œ</option>
</select>

<input type="text" id="memo" placeholder="ë©”ëª¨">
<button onclick="add()">ì¶”ê°€</button>

<ul id="list"></ul>

<div class="stats" id="stats"></div>

<script>
  let data = JSON.parse(localStorage.getItem("expenses") || "[]");

  function render() {
    const list = document.getElementById("list");
    const stats = document.getElementById("stats");
    list.innerHTML = "";

    let total = 0;
    let monthly = {};

    data.forEach((e, i) => {
      total += Number(e.amount);

      const month = e.date.slice(0, 7);
      monthly[month] = (monthly[month] || 0) + Number(e.amount);

      const li = document.createElement("li");

      li.innerHTML = `
        <div class="info">
          ${e.date} | ${e.type} | ${e.amount.toLocaleString()}ì›<br>
          ${e.memo || ""}
        </div>
        <button class="delete" onclick="remove(${i})">ì‚­ì œ</button>
      `;
      list.appendChild(li);
    });

    const months = Object.keys(monthly);
    const avg = months.length
      ? Math.round(total / months.length)
      : 0;

    stats.innerHTML = `
      ì´ ì§€ì¶œ: ${total.toLocaleString()}ì›<br>
      ì›” í‰ê·  ì§€ì¶œ: ${avg.toLocaleString()}ì›
    `;

    localStorage.setItem("expenses", JSON.stringify(data));
  }

  function add() {
    const date = document.getElementById("date").value;
    const amount = document.getElementById("amount").value;
    const type = document.getElementById("type").value;
    const memo = document.getElementById("memo").value;

    if (!date || !amount) {
      alert("ë‚ ì§œì™€ ê¸ˆì•¡ì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
      return;
    }

    data.push({ date, amount: Number(amount), type, memo });
    render();
  }

  function remove(index) {
    if (confirm("ì‚­ì œí• ê¹Œìš”?")) {
      data.splice(index, 1);
      render();
    }
  }

  render();
</script>

</body>
</html>
